{"version":3,"file":"tbl.js","sourceRoot":"","sources":["../../../ts/src/bball/tbl.ts"],"names":[],"mappings":"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","sourcesContent":["// replaces /www/js/bball/dynamic_table.js\n// dynamic replacement for lg_ldg_scorers.js, rg_ldg_scorer.js, reamrecs.js\n\nimport { playerBtnListener } from \"./listeners.js\";\nimport { base, foldedLog, MSG } from \"../global.js\";\n\ntype CellValue<T> = (data: T | any, idx: number) => string;\n\ntype Column<T> = {\n    header: string;\n    value: CellValue<T>;\n    button?: {\n        onClick: (value: string, data: T, idx: number) => Promise<void>;\n    };\n};\n\nexport class Tbl<T> {\n    private data!: T;\n\n    constructor(\n        private elId: string,\n        private title: string,\n        private rowCount: number,\n        private url: string,\n        private columns: Column<T>[],\n    ) {}\n\n    async init(): Promise<void> {\n        const r = await fetch(this.url);\n        this.data = await r.json();\n        this.build();\n    }\n\n    private build(): void {\n        let tbl = document.getElementById(this.elId) as HTMLTableElement;\n        tbl.innerHTML = '';\n\n        tbl.appendChild(this.makeTitle());\n\n        tbl.appendChild(this.makeHdrRow());\n\n        for (let i = 0; i < this.rowCount; i++) {\n            tbl.appendChild(this.makeRow(i));\n        }\n    }\n\n    makeTitle(): HTMLTableCaptionElement {\n    let capt = document.createElement('caption') as HTMLTableCaptionElement;\n        capt.textContent = this.title;\n        return capt;\n    }\n\n    makeHdrRow(): HTMLTableSectionElement {\n        const thead = document.createElement('thead');\n        const tr = document.createElement('tr');\n        for (const col of this.columns) {\n            const td = document.createElement('td');\n            td.textContent = col.header;\n            tr.appendChild(td);\n        }\n        thead.appendChild(tr);\n        return thead;\n    }\n\n    makeRow(idx: number): HTMLTableRowElement {\n        const tr = document.createElement(\"tr\");\n\n        this.columns.forEach(col => {\n            const td = document.createElement('td');\n            const val = col.value(this.data, idx);\n            if (col.button) {\n                const btn = document.createElement(\"button\");\n                btn.type = \"button\";\n                btn.textContent = val;\n                btn.onclick = () => col.button!.onClick(val, this.data, idx);\n                td.appendChild(btn);\n            } else {\n                td.textContent = val;\n            }\n\n            tr.appendChild(td);\n        })\n        return tr;\n    }\n}\n\nconst getRGRow = (d: any, i: number) => {\n    const player = d.top_scorers[i];\n    const game = d.recent_games.find(\n        (g: any) => g.player_id === player.player_id\n    );\n    return { player, game };\n};\n\n// top scorers from most recent day of games\nexport async function makeRgTopScorersTbl(numRows: number): Promise<void> {\n    let datasrc = `${base}/games/recent`;\n    let r = await fetch(datasrc);\n    const data = await r.json();\n    foldedLog(`attempting to build RgTopScorers table...`);\n    console.log(data);\n    new Tbl(\n        'tstbl', \n        `Top ${Math.min(numRows, data.top_scorers.length)} Scorers | ${data.recent_games[0].game_date}`,\n        numRows, datasrc, [\n            {\n                header: 'rank',\n                value: (_, i) => String(i + 1),\n            },\n            {\n                header: 'name | team',\n                value: (d, i) => {\n                    const { player, game } = getRGRow(d, i);\n                    return `${player.player} | ${game.team}`;\n\n                },\n                button: {\n                    onClick: async (v) => playerBtnListener(v.split(\" | \")[0]),\n                },\n            },\n            {\n                header: 'matchup',\n                value: (d, i) => {\n                    const { game } = getRGRow(d, i);\n                    return game.matchup;\n                },\n            },\n            {\n                header: 'wl | score',\n                value: (d, i) => {\n                    const { game } = getRGRow(d, i);\n                    return `${game.wl} | ${game.points}-${game.opp_points}`;\n                },\n                button: {\n                    onClick: async (v) => playerBtnListener(v.split(\" | \")[0]),\n                },\n            },\n            {\n                header: 'points',\n                value: (d, i) => String(d.top_scorers[i].points),\n            },\n        ]\n    ).init();\n}\n\n// top scorers in the current season\nexport async function makeLgTopScorersTbl(numRows: number): Promise<void> {\n    let datasrc = `${base}/league/scoring-leaders?num=${numRows}`;\n    let r = await fetch(datasrc);\n    const data = await r.json();\n    new Tbl(\n        'nba_tstbl', \n        `Scoring Leaders | NBA/WNBA Top ${numRows}`,\n        numRows, datasrc, [\n            {\n                header: \"rank\", \n                value: (_, i) => String(i + 1),\n            }, \n            {\n                header: `nba | ${data.nba[0].season}`, \n                value: (d, i) => `${d.nba[i].player}`,\n                button: {\n                    onClick: async (v) => playerBtnListener(v.split(\" | \")[0]),\n                }\n            },\n            {\n                header: \"points\",\n                value: (d, i) => String(d.nba[i].points),\n            },\n            {\n                header: `wnba | ${data.wnba[0].season}`,\n                value: (d: any, i) => `${d.wnba[i].player} | ${d.wnba[i].team}`,\n                button: {\n                    onClick: async (v) => playerBtnListener(v.split(\" | \")[0]),\n                },\n            },\n            {\n                header: \"points\",\n                value: (d, i) => String(d.wnba[i].points),\n            },\n        ]\n    ).init();\n}\n\nexport async function makeTeamRecordsTbl(numRows: number): Promise<void> {\n    let datasrc = `${base}/teamrecs`;\n    let r = await fetch(datasrc);\n    const data = await r.json();\n    new Tbl(\n    \"trtbl\",\n    \"NBA/WNBA Regular Season Team Records\", numRows, datasrc, \n    [\n        { header: \"rank\", value: (_, i) => String(i + 1) },\n        {\n            header: `nba | ${data.nba_team_records[0].season}`,\n            value: (d, i) => d.nba_team_records[i].team_long,\n        },\n        {\n            header: \"record\",\n            value: (d, i) => `${d.nba_team_records[i].wins}-${d.nba_team_records[i].losses}`,\n        },\n        {\n            header: `wnba | ${data.wnba_team_records[0].season}`,\n            value: (d, i) => d.wnba_team_records[i].team_long,\n        },\n        {\n            header: \"record\",\n            value: (d, i) => `${d.wnba_team_records[i].wins}-${d.wnba_team_records[i].losses}`,\n        },\n    ],\n    ).init();\n}"]}