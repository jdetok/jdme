{"version":3,"file":"tbl.js","sourceRoot":"","sources":["../../../ts/src/bball/tbl.ts"],"names":[],"mappings":"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","sourcesContent":["// replaces /www/js/bball/dynamic_table.js\n// dynamic replacement for lg_ldg_scorers.js, rg_ldg_scorer.js, reamrecs.js\n\nimport { foldedLog, MSG } from \"../global.js\";\n\ntype TopScorer = {\n    player_id: number;\n    team_id: number;\n    player: string;\n    league: string;\n    points: number;\n    assists: number;\n    rebounds: number;\n};\n\ntype RecentGame = {\n    game_id: number;\n    team_id: number;\n    player_id: number;\n    player: string;\n    league: string;\n    team: string;\n    team_name: string;\n    game_date: string;\n    matchup: string;\n    wl: string;\n    points: number;\n    opp_points: number;\n};\n\ntype FldSearchFn = (searchFor: string) => Promise<void>;\n\ntype fld<T> = {\n    txt: string;\n    val: (row: T, idx: number) => string;\n    btnFn?: FldSearchFn | null;\n}\n\nclass Tbl<T> {\n    el: HTMLTableElement | null = null;\n    elName: string;\n    title: string;\n    hdrs: fld<T>[];\n    rowNum: number;\n    searchFor: string | null;\n    url: string;\n    data: T[] = [];\n    btnFunc: FldSearchFn | null = null;\n\n    constructor(elName: string, ttl: string, rows: number, hdrs: fld<T>[], searchFor: string | null = null, url: string) {\n        this.elName = elName;\n        this.title = ttl;\n        this.rowNum = rows;\n        this.hdrs = hdrs;\n        this.searchFor = searchFor;\n        this.url = url;\n        this.getData();\n        this.build();\n    }\n\n    async getData(): Promise<void>{\n        try {\n            const r = await fetch(this.url);\n            let js = await r.json();\n            this.data = js;\n        } catch (ex) {\n            throw new Error(`failed getting data from ${this.url}: ${ex}`)\n        }\n    }\n\n    build(): void {\n        let tbl = document.getElementById(this.elName) as HTMLTableElement | null;\n        if (!tbl) throw new Error(`failed to find table element with id: ${this.elName}:`);\n        let tblCapt = this.makeTitle();\n        if (!tblCapt) throw new Error(`failed creating caption: ${this.title}`);\n        tbl.appendChild(tblCapt);\n\n        let hdrRow = this.makeHdrRow();\n        if (!hdrRow) throw new Error(`failed to create header row: ${this.hdrs}`);\n        tbl.appendChild(hdrRow);\n\n        let rows = this.makeRows();\n        if (!rows) throw new Error(`failed to make data rows`);\n        for (let row of rows) {\n            tbl.appendChild(row);\n        }\n    }\n\n    makeTitle(): HTMLTableCaptionElement | null {\n    let capt = document.createElement('caption') as HTMLTableCaptionElement | null;\n        if (!capt) return null\n        capt.textContent = this.title;\n        return capt;\n    }\n\n    makeHdrRow(): HTMLTableSectionElement | null {\n        let thead = document.createElement('thead');\n        for (let hdr of this.hdrs) {\n            let el = document.createElement('td') as HTMLTableCellElement | null;\n            if (!el) return null;\n            el.textContent = hdr.txt;\n            thead.appendChild(el);\n        }\n        return thead;\n    }\n\n    makeRows(): HTMLTableRowElement[] | null {\n        let rows: HTMLTableRowElement[] = [];\n        for (let i = 0; i < this.rowNum; i++) {\n            let row = document.createElement('tr') as HTMLTableRowElement;\n            for (let hdr of this.hdrs) {\n                let cell = document.createElement('td') as HTMLTableCellElement;\n                const val = hdr.val(this.data[i], i);\n                if (hdr.btnFn) {\n                    let btn = document.createElement('button') as HTMLButtonElement;\n                    btn.type = 'button';\n                    btn.textContent = val;\n                    if (this.searchFor) {\n                        btn.addEventListener('click', async () => {\n                            await hdr.btnFn!(this.searchFor ?? val);\n                        });\n                    }\n                    cell.appendChild(btn);\n                } else {\n                    cell.textContent = val;\n                }\n                row.appendChild(cell);\n            }\n            rows.push(row);\n        }\n        return rows;\n    }\n}"]}